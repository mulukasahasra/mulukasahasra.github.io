<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <title>Payment</title>
  </head>
  <body>
    <h3 class="text-center"> Payment Processing System</h3>
    <div class="container py-3">
      <div class="col-12 col-sm-8 col-md-6 mx-auto">
        <nav class="nav nav-pills nav-justified">
          <a class="nav-item nav-link active" href="index.html">Payment</a>
          <a class="nav-item nav-link" href="authcodes.html">Authorization Codes</a>
        </nav>
      </div>
      <br/>
      <br/>
      <div class="row">
        
          <div class="col-12 col-sm-8 col-md-6 mx-auto">
              <div id="pay-invoice" class="card">
                  <div class="card-body">
                      <div class="card-title">
                          <h2 class="text-center">Pay Invoice</h2>
                      </div>
                      <hr>
                      <!-- <form> -->
                          <input type="hidden" id="x_first_name" name="x_first_name" value="">
                          <input type="hidden" id="x_last_name" name="x_last_name" value="">
                          <input type="hidden" id="x_card_num" name="x_card_num" value="">
                          <input type="hidden" id="x_exp_date" name="x_exp_date" value="">
                          <div class="form-group text-center">
                              <ul class="list-inline">
                                  <li class="list-inline-item"><i class="text-muted fa fa-cc-visa fa-2x"></i></li>
                                  <li class="list-inline-item"><i class="fa fa-cc-mastercard fa-2x"></i></li>
                                  <li class="list-inline-item"><i class="fa fa-cc-amex fa-2x"></i></li>
                                  <li class="list-inline-item"><i class="fa fa-cc-discover fa-2x"></i></li>
                              </ul>
                          </div>
                          <div class="form-group">
                            
                              <label>Payment amount</label>
                              <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                  <span class="input-group-text" id="basic-addon1">Total $</span>
                                </div>
                                <input id="totalAmount" type="text" class="form-control" aria-describedby="basic-addon1" onchange="updateTotal()">
                              </div>
              
                          </div>
                          <div class="form-group has-success">
                              <label for="cc-name" class="control-label">Name on card</label>
                              <input id="cc-name" name="cc-name" type="text" class="form-control cc-name valid" data-val="true" data-val-required="Please enter the name on card" autocomplete="cc-name" aria-required="true" aria-invalid="false" aria-describedby="cc-name-error">
                              <span class="help-block field-validation-valid" data-valmsg-for="cc-name" data-valmsg-replace="true"></span>
                          </div>
                          <div class="form-group">
                              <label for="cc-number" class="control-label">Card number</label>
                              <input id="cc-number" name="cc-number" type="tel" class="form-control cc-number identified visa" value="" data-val="true" data-val-required="Please enter the card number" data-val-cc-number="Please enter a valid card number" autocomplete="cc-number">
                              <span class="help-block" data-valmsg-for="cc-number" data-valmsg-replace="true"></span>
                          </div>
                          <div class="row">
                              <div class="col-6">
                                  <div class="form-group">
                                      <label for="cc-exp" class="control-label">Expiration</label>
                                      <input id="cc-exp" name="cc-exp" type="tel" class="form-control cc-exp" value="" data-val="true" data-val-required="Please enter the card expiration" data-val-cc-exp="Please enter a valid month and year" placeholder="MM / YY" autocomplete="cc-exp">
                                      <span class="help-block" data-valmsg-for="cc-exp" data-valmsg-replace="true"></span>
                                  </div>
                              </div>
                              <div class="col-6">
                                  <label for="x_card_code" class="control-label">Security code</label>
                                  <div class="input-group">
                                      <input id="x_card_code" name="x_card_code" type="tel" class="form-control cc-cvc" value="" data-val="true" data-val-required="Please enter the security code" data-val-cc-cvc="Please enter a valid security code" autocomplete="off">
                                      <div class="input-group-addon">
                                          <span class="fa fa-question-circle fa-lg" data-toggle="popover" data-container="body" data-html="true" data-title="Security Code" 
                                          data-content="<div class='text-center one-card'>The 3 digit code on back of the card..<div class='visa-mc-cvc-preview'></div></div>"
                                          data-trigger="hover"></span>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <div class="form-group">
                              <label for="x_zip" class="control-label">Postal code</label>
                              <input id="x_zip" name="x_zip" type="text" class="form-control" value="" data-val="true" data-val-required="Please enter the ZIP/Postal code" autocomplete="postal-code">
                              <span class="help-block" data-valmsg-for="x_zip" data-valmsg-replace="true"></span>
                          </div>
                          <div>
                          </div>
                      <!-- </form> -->
                      <hr/>
                      <button id="total" class="btn btn-lg btn-success btn-block" onclick="verifyPayment()">Pay $0</button>
                  </div>
              </div>
          </div>
      </div>
  </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  
    <script>
      function updateTotal(){
      const total = document.getElementById('totalAmount').value
      document.getElementById('total').innerHTML = "Pay $" + total
      } 

      var input = document.getElementById("totalAmount");
      input.addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            event.preventDefault();
            const total = document.getElementById('totalAmount').value
            document.getElementById('total').innerHTML = "Pay $" + total
  }
}); 

    function verifyPayment(){

        var details = {
          cardNum : '',
          cardName : '',
          expiry : '',
          cvv : '',
          postalCode : '',
          total: '0'
        }
        console.log(details)
        details.cardName = $('#cc-name').val()
        details.cardNum = $('#cc-number').val()
        details.total = $('#totalAmount').val()
        details.expiry = $('#cc-exp').val()
        details.cvv = $('#x_card_code').val()
        details.postalCode = $('#x_zip').val()
        console.log(details)
        var isValid = true
        for(const detail in details){
            if(details[detail].length < 1){
                alert("Please enter valid "+ detail);
                isValid = false;
                return null;
            }
        }
        if(details.cardNum < 16){
            alert("Please enter a valid card number. Dont Use Spaces or Hypens(-)");
            isValid = false;
            return null;
        }
        if(details.postalCode < 5){
            alert("Please enter a valid 5 digit postal Code");
            isValid = false;
            return null;
        }        
        if(isValid){
        fetch('https://w8k5gt18se.execute-api.us-east-1.amazonaws.com/Production/verifypayment', {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(details)
        })
        .then(response => response.json())
        .then(response => alert(JSON.stringify(response.isAuthorized)))
     }
    }
    </script>
  </body>
</html>
